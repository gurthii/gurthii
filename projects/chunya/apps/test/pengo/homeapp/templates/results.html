{% extends 'base.html' %}
{% block title %}Price History{% endblock %}

{% block content %}
<div class="results-layout">
    <div class="chart-area">
        <div class="chart-header">
            <h3>{{ chart_product.product_name }}</h3>
            <p class="current-price-display">Current Price: Ksh. {{ chart_product.current_price }}</p>
            <p class="last-updated">Last updated: {{ chart_product.last_updated }}</p>
        </div>
        <canvas id="priceChart"></canvas>
    </div>
    
    <div class="side-actions">
        <div class="button-container">
            <button class="action-button" onclick="showModal()">+ Track Price</button>
            
            <!-- Price Tracker Modal -->
            <div id="modal" class="modal">
                <div class="modal-content">
                    <!-- <h3>Price Tracker</h3> -->
                    <p>Set your desired price and we will notify you via email when the price drops!</p>
                    <p><span class="current-price">Current Price</span>: Ksh. {{ chart_product.current_price }}</p>
                    <p class="timestamp">As of {{ chart_product.last_updated }}</p>
                    
                    <form onsubmit="saveData(event)">
                        <input type="number" name="targetPrice" placeholder="Target Price: " required>
                        <input type="email" name="userEmail" placeholder="Email: " required>
                        <p id="saveStatus" class="save-status"></p>
                        <div class="modal-buttons">
                            <button type="button" onclick="hideModal()">Cancel</button>
                            <button type="submit">Save</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
        <button class="action-button">View on Jumia.co.ke</button>
    </div>
</div>

<!-- Chart.js CDN -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<script>
// Simple chart - no complex config
document.addEventListener('DOMContentLoaded', function() {
    const ctx = document.getElementById('priceChart');
    const chartData = {{ chart_data|safe }};
    
    new Chart(ctx, {
        type: 'line',
        data: {
            labels: chartData.labels,
            datasets: [{
                data: chartData.prices,
                borderColor: '#333',
                backgroundColor: 'rgba(51, 51, 51, 0.1)',
                borderWidth: 2,
                fill: false
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false
        }
    });
});
</script>
{% endblock %}